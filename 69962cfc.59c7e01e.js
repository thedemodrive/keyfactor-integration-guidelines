(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{60:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return o})),a.d(t,"metadata",(function(){return c})),a.d(t,"rightToc",(function(){return i})),a.d(t,"default",(function(){return b}));var s=a(2),n=a(6),l=(a(0),a(75)),o={id:"istio-sample",title:"Istio Examples",sidebar_label:"Istio Examples",slug:"/istio/samples"},c={unversionedId:"istio-sample",id:"istio-sample",isDocsHomePage:!1,title:"Istio Examples",description:"Setup example Microservices",source:"@site/docs/istio-sample.md",slug:"/istio/samples",permalink:"/keyfactor-integration-guidelines/docs/istio/samples",editUrl:"https://github.com/thedemodrive/keyfactor-integration-guidelines/blob/master/docs/istio-sample.md",version:"current",sidebar_label:"Istio Examples",sidebar:"someSidebar",previous:{title:"Install Istio",permalink:"/keyfactor-integration-guidelines/docs/istio"},next:{title:"Keyfactor Certificate Signer",permalink:"/keyfactor-integration-guidelines/docs/kubernetes/example"}},i=[{value:"Setup example Microservices",id:"setup-example-microservices",children:[]},{value:"HOW TO VERIFY THE TRAFFIC IS USING MUTUAL TLS ENCRYPTION",id:"how-to-verify-the-traffic-is-using-mutual-tls-encryption",children:[]}],p={rightToc:i};function b(e){var t=e.components,a=Object(n.a)(e,["components"]);return Object(l.b)("wrapper",Object(s.a)({},p,a,{components:t,mdxType:"MDXLayout"}),Object(l.b)("h3",{id:"setup-example-microservices"},"Setup example Microservices"),Object(l.b)("p",null,"Deploy Book-Info microservice example of Istio (",Object(l.b)("a",Object(s.a)({parentName:"p"},{href:"https://istio.io/docs/examples/bookinfo/"}),"references"),")\n",Object(l.b)("img",Object(s.a)({parentName:"p"},{src:"https://istio.io/latest/docs/examples/bookinfo/withistio.svg",alt:"Book Info Sample"}))),Object(l.b)("p",null,"Turn on Istio auto-inject for namespace ",Object(l.b)("strong",{parentName:"p"},"default")),Object(l.b)("pre",null,Object(l.b)("code",Object(s.a)({parentName:"pre"},{className:"language-bash"}),"kubectl label namespace default istio-injection=enabled\n")),Object(l.b)("p",null,"Deploy an example of istio (",Object(l.b)("a",Object(s.a)({parentName:"p"},{href:"https://istio.io/docs/examples/bookinfo/"}),"Book-Info"),")"),Object(l.b)("pre",null,Object(l.b)("code",Object(s.a)({parentName:"pre"},{className:"language-bash"}),"kubectl apply -f manifests/samples/bookinfo/platform/kube/bookinfo.yaml\n")),Object(l.b)("p",null,"Configure a gateway for the Book-Info sample"),Object(l.b)("pre",null,Object(l.b)("code",Object(s.a)({parentName:"pre"},{className:"language-bash"}),"kubectl apply -f manifests/samples/bookinfo/networking/bookinfo-gateway.yaml\n")),Object(l.b)("p",null,"Configure mTLS destination rules"),Object(l.b)("pre",null,Object(l.b)("code",Object(s.a)({parentName:"pre"},{className:"language-bash"}),"kubectl apply -f manifests/samples/bookinfo/networking/destination-rule-all-mtls.yaml\n")),Object(l.b)("p",null,"Lock down mutual TLS for the entire mesh"),Object(l.b)("pre",null,Object(l.b)("code",Object(s.a)({parentName:"pre"},{className:"language-bash"}),"kubectl apply -f manifests/samples/peer-authentication.yaml\n")),Object(l.b)("h3",{id:"how-to-verify-the-traffic-is-using-mutual-tls-encryption"},"HOW TO VERIFY THE TRAFFIC IS USING MUTUAL TLS ENCRYPTION"),Object(l.b)("p",null,"Lock down mutual TLS for the entire mesh"),Object(l.b)("pre",null,Object(l.b)("code",Object(s.a)({parentName:"pre"},{className:"language-bash"}),"kubectl apply -f manifests/samples/peer-authentication.yaml\n")),Object(l.b)("p",null,'Create the namespace "insidemesh" and deploy a sleep container ',Object(l.b)("strong",{parentName:"p"},"with sidecars")),Object(l.b)("pre",null,Object(l.b)("code",Object(s.a)({parentName:"pre"},{className:"language-bash"}),"kubectl create ns insidemesh\nkubectl label namespace insidemesh istio-injection=enabled\nkubectl apply -f manifests/samples/sleep/sleep.yaml -n insidemesh\n")),Object(l.b)("hr",null),Object(l.b)("p",null,"Verify the setup by sending an http request (using curl command) from sleep pod (namespace: insidemesh) to productpage.default:9080:"),Object(l.b)("ol",null,Object(l.b)("li",{parentName:"ol"},"To check if the certificate get from productpage.default is issued by KeyfactorCA")),Object(l.b)("pre",null,Object(l.b)("code",Object(s.a)({parentName:"pre"},{className:"language-bash"}),"kubectl exec $(kubectl get pod -l app=sleep -n insidemesh -o jsonpath={.items..metadata.name}) -c sleep -n insidemesh -- openssl s_client -showcerts -connect productpage.default:9080\n")),Object(l.b)("ol",{start:2},Object(l.b)("li",{parentName:"ol"},"Request using curl")),Object(l.b)("pre",null,Object(l.b)("code",Object(s.a)({parentName:"pre"},{className:"language-bash"}),'kubectl exec $(kubectl get pod -l app=sleep -n insidemesh -o jsonpath={.items..metadata.name}) -c sleep -n insidemesh -- curl http://productpage.default:9080 -s -o /dev/null -w "sleep.insidemesh to http://productpage.default:9080: -> HTTP_STATUS: %{http_code}\\n"\n')),Object(l.b)("blockquote",null,Object(l.b)("p",{parentName:"blockquote"},"Note: every workload ",Object(l.b)("strong",{parentName:"p"},"deployed with sidecar")," can access Book Info services (HTTP_STATUS = 200)")),Object(l.b)("p",null,'Create another namespace "outsidemesh" and deploy a sleep container ',Object(l.b)("strong",{parentName:"p"},"without a sidecar")),Object(l.b)("pre",null,Object(l.b)("code",Object(s.a)({parentName:"pre"},{className:"language-bash"}),"kubectl create ns outsidemesh\nkubectl apply -f manifests/samples/sleep/sleep.yaml -n outsidemesh\n")),Object(l.b)("hr",null),Object(l.b)("p",null,"Verify the setup by sending an http request (using curl command) from sleep pod (namespace: outsidemesh) to productpage.default:9080:"),Object(l.b)("pre",null,Object(l.b)("code",Object(s.a)({parentName:"pre"},{className:"language-bash"}),'kubectl exec $(kubectl get pod -l app=sleep -n outsidemesh -o jsonpath={.items..metadata.name}) -c sleep -n outsidemesh -- curl http://productpage.default:9080 -s -o /dev/null -w "sleep.outsidemesh to http://productpage.default:9080: -> HTTP_STATUS: %{http_code}\\n"\n')),Object(l.b)("blockquote",null,Object(l.b)("p",{parentName:"blockquote"},"Note: every workload ",Object(l.b)("strong",{parentName:"p"},"deployed without sidecar")," cannot access Book Info services (HTTP_STATUS = 000)")))}b.isMDXComponent=!0}}]);