(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{66:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return c})),a.d(t,"metadata",(function(){return i})),a.d(t,"rightToc",(function(){return o})),a.d(t,"default",(function(){return l}));var r=a(2),n=a(6),s=(a(0),a(75)),c={id:"kubernetes",title:"Keyfactor Certificate Signer",sidebar_label:"Issue New Certificate",slug:"/kubernetes/example"},i={unversionedId:"kubernetes",id:"kubernetes",isDocsHomePage:!1,title:"Keyfactor Certificate Signer",description:"Test Keyfactor Integrate With Kubernetes",source:"@site/docs/kubernetes.md",slug:"/kubernetes/example",permalink:"/keyfactor-integration-guidelines/docs/kubernetes/example",editUrl:"https://github.com/thedemodrive/keyfactor-integration-guidelines/blob/master/docs/kubernetes.md",version:"current",sidebar_label:"Issue New Certificate",sidebar:"someSidebar",previous:{title:"Istio Examples",permalink:"/keyfactor-integration-guidelines/docs/istio/samples"}},o=[{value:"Test Keyfactor Integrate With Kubernetes",id:"test-keyfactor-integrate-with-kubernetes",children:[]}],b={rightToc:o};function l(e){var t=e.components,a=Object(n.a)(e,["components"]);return Object(s.b)("wrapper",Object(r.a)({},b,a,{components:t,mdxType:"MDXLayout"}),Object(s.b)("h3",{id:"test-keyfactor-integrate-with-kubernetes"},"Test Keyfactor Integrate With Kubernetes"),Object(s.b)("h4",{id:"1-create-csr-certificate-signing-request"},"1. Create CSR (Certificate Signing Request)"),Object(s.b)("p",null,"The following scripts show how to generate PKI private key and CSR"),Object(s.b)("pre",null,Object(s.b)("code",Object(r.a)({parentName:"pre"},{className:"language-bash"}),"openssl genrsa -out keyfactor.key 2048\nopenssl req -new -key keyfactor.key -out keyfactor.csr\n")),Object(s.b)("h4",{id:"2-create-or-update-file-at-manifestssamplessample-csryaml"},"2. Create or update file at ",Object(s.b)("inlineCode",{parentName:"h4"},"manifests/samples/sample-csr.yaml")),Object(s.b)("pre",null,Object(s.b)("code",Object(r.a)({parentName:"pre"},{className:"language-yaml"}),'apiVersion: certificates.k8s.io/v1beta1\nkind: CertificateSigningRequest\nmetadata:\n  name: <REPLACE_CSR_NAME>\n  annotations:\n    ServiceName: "ServiceName1234" # Example metadata\n    ClusterID: "ClusterID123" # Example metadata\n    TrustDomain: "cluster.local" # Example metadata\n    PodName: "ABC/XYZ" # Example metadata\n    PodNamespace: "Namespace" # Example metadata\n    PodIP: "192.168.3.2" # Example metadata\nspec:\n  request: <REPLACE_CSR_HERE>\n  usages:\n    - client auth\n    - server auth\n  signerName: "keyfactor.com/<REPLACE_ANY_NAME>"\n')),Object(s.b)("h4",{id:"3-submit-csr-to-kubernetes-by-cli"},"3. Submit CSR to Kubernetes by CLI"),Object(s.b)("pre",null,Object(s.b)("code",Object(r.a)({parentName:"pre"},{className:"language-Bash"}),"kubectl apply -f manifests/samples/sample-csr.yaml\n")),Object(s.b)("h4",{id:"4-approve-csr"},"4. Approve CSR"),Object(s.b)("pre",null,Object(s.b)("code",Object(r.a)({parentName:"pre"},{className:"language-Bash"}),"kubectl certificate approve <REPLACE_CSR_NAME>\n")),Object(s.b)("h4",{id:"5-check-csr-status"},"5. Check CSR status"),Object(s.b)("pre",null,Object(s.b)("code",Object(r.a)({parentName:"pre"},{className:"language-Bash"}),"kubectl get csr\n")),Object(s.b)("p",null,Object(s.b)("img",Object(r.a)({parentName:"p"},{src:"https://github.com/thedemodrive/keyfactor-istio/raw/master/img/CSR%20Status.png",alt:"Example"}))),Object(s.b)("blockquote",null,Object(s.b)("p",{parentName:"blockquote"},"Note: The condition of CSR should be Approved,Issued")),Object(s.b)("ol",{start:6},Object(s.b)("li",{parentName:"ol"},"Show detail signed certificate")),Object(s.b)("pre",null,Object(s.b)("code",Object(r.a)({parentName:"pre"},{className:"language-bash"}),"kubectl get csr <REPLACE_CSR_NAME> -o=jsonpath='{.status.certificate}'\n")),Object(s.b)("blockquote",null,Object(s.b)("p",{parentName:"blockquote"},"Note: Certificate is encoded by Base64")))}l.isMDXComponent=!0}}]);