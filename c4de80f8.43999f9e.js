(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{107:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/finished-e7242c5afd7ec85f5a7298199300e587.png"},63:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return r})),n.d(t,"metadata",(function(){return o})),n.d(t,"rightToc",(function(){return l})),n.d(t,"default",(function(){return c}));var a=n(2),i=(n(0),n(75));const r={id:"install",title:"Install",sidebar_label:"Install",slug:"/install"},o={unversionedId:"install",id:"install",isDocsHomePage:!1,title:"Install",description:"1. Download and extract bundle",source:"@site/docs/install.md",slug:"/install",permalink:"/keyfactor-integration-guidelines/docs/install",editUrl:"https://github.com/thedemodrive/keyfactor-integration-guidelines/blob/master/docs/install.md",version:"current",sidebar_label:"Install",sidebar:"someSidebar",previous:{title:"Prerequisite",permalink:"/keyfactor-integration-guidelines/docs/"},next:{title:"Install Istio",permalink:"/keyfactor-integration-guidelines/docs/istio"}},l=[{value:"1. Download and extract bundle",id:"1-download-and-extract-bundle",children:[]},{value:"2. Create a Kubernetes Secret contains Keyfactor&#39;s credentials",id:"2-create-a-kubernetes-secret-contains-keyfactors-credentials",children:[]},{value:"3. Install Keyfactor Kubernetes Proxy via Helm 3",id:"3-install-keyfactor-kubernetes-proxy-via-helm-3",children:[]},{value:"3. Install finished",id:"3-install-finished",children:[]}],s={rightToc:l};function c({components:e,...t}){return Object(i.b)("wrapper",Object(a.a)({},s,t,{components:e,mdxType:"MDXLayout"}),Object(i.b)("h3",{id:"1-download-and-extract-bundle"},"1. Download and extract bundle"),Object(i.b)("p",null,"Download following bundles:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("strong",{parentName:"p"},"manifests.zip")," (",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/thedemodrive/keyfactor-integration-guidelines/releases/download/1.0.0/manifests.zip"}),Object(i.b)("em",{parentName:"a"},"Download Here")),")\nA bundle constains manifest and sample configurations - This bundle requires extract")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("strong",{parentName:"p"},"keyfactor-kubernetes-1.0.0.tgz")," (",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/thedemodrive/keyfactor-integration-guidelines/releases/download/1.0.0/keyfactor-kubernetes-1.0.0.tgz"}),Object(i.b)("em",{parentName:"a"},"Download Here")),")\nA Helm chart to deploy Keyfactor Kubernetes Proxy"))),Object(i.b)("h3",{id:"2-create-a-kubernetes-secret-contains-keyfactors-credentials"},"2. Create a Kubernetes Secret contains Keyfactor's credentials"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Create or update file at ",Object(i.b)("inlineCode",{parentName:"li"},"manifests/credentials.yaml"))),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml"}),'# Endpoint of Keyfactor Platform\nendPoint: ""\n\n# Name of certificate authorization for enroll Istio\'s Workload Certificate\ncaName: ""\n\n# Using for authentication header: "Basic ...."\nauthToken: "Basic <REPLACE>"\n\n# API path for enroll new certificate from Keyfactor\nenrollPath: "KeyfactorAPI/Enrollment/CSR"\n\n# Certificate Template for enroll Istio\'s Workload Certificate: Default is Istio\ncaTemplate: "Istio"\n\n# ApiKey from Api Setting, for enroll Istio\'s Workload Certificate\nappKey: ""\n\n# ApiKey for auto provisioning TLS server / client certificates\n# Keyfactor Kubernetes Proxy need 2 API Client:\n# 1. For enroll Istio\'s Workload Certificate - using template Istio\n# 2. For enroll Keyfactor Kubernetes Proxy\'s Server/Client Certificate - using template K8SProxy\nprovisioningAppKey: ""\n\n# CA Template for auto provisioning TLS server / client certificates\nprovisioningTemplate: "K8SProxy"\n')),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Create a Kubernetes Secret with name ",Object(i.b)("inlineCode",{parentName:"li"},"keyfactor-credentials")," with above file")),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"kubectl create namespace keyfactor\nkubectl create secret generic keyfactor-credentials -n keyfactor --from-file credentials.yaml\n")),Object(i.b)("h3",{id:"3-install-keyfactor-kubernetes-proxy-via-helm-3"},"3. Install Keyfactor Kubernetes Proxy via Helm 3"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Custom helm's values at ",Object(i.b)("inlineCode",{parentName:"li"},"manifests/keyfactor-config.yaml"))),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml"}),"# Number of replication for Keyfactor-Proxy\nreplicaCount: 1\n\nimage:\n  repository: thedemodrive/keyfactor-proxy\n  tag: 1.0.0\n  pullPolicy: IfNotPresent\n\nkeyfactor:\n  environment: Production\n  # Disable mTLS protocol for gRPC Server of Keyfactor-Kubernetes-Proxy - For testing only\n  disableMTLS: false\n  # Istio need some Client TLS Certificates to connect to Keyfactor-Kubernetes-Proxy gRPC server (mTLS protocol)\n  # On this flag is setted to true, Keyfactor-Kubernetes-Proxy will automatically provisioning a Kubernetes Secret\n  # which contains TLS Client Certs to enable mTLS between Istio <> Keyfactor K8S Proxy\n  enableAutoProvisioningIstioCert: true\n  # Namespace of Istio Deployment\n  istioNamespace: istio-system\n  # Name of kubernetes secret contains TLS Client Certs is used within Istio Config\n  istioSecretName: custom-ca-tls\n\n  # Name of kubernetes secret contains credentials.yaml\n  secretName: \"keyfactor-credentials\"\n  # Config name mapping Keyfactor's Custom Metadata, turn off field by remove item\n  # Config pattern: [Istio Field Name] : [Keyfactor Metadata Name]\n  # Supported Istio's Metadata: ClusterID, ServiceName, PodName, PodIP, PodNamespace, TrustDomain\n  metadataMapping:\n    ClusterID: Cluster\n    ServiceName: Service\n    PodName: PodName\n    PodIP: PodIP\n    PodNamespace: PodNamespace\n    TrustDomain: TrustDomain # Value Example: cluster.local\n")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Install via Helm command")),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"helm install keyfactor-k8s -n keyfactor keyfactor-kubernetes-1.0.0.tgz -f keyfactor-config.yaml --wait\n")),Object(i.b)("h3",{id:"3-install-finished"},"3. Install finished"),Object(i.b)("p",null,"Keyfactor K8S Proxy will auto provisioning TLS Client Certificates for Istio Integrating. The following values are used at Istio Integration:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"<REPLACE_ADDRESS>"),Object(i.b)("li",{parentName:"ul"},"<REPLACE_PORT>"),Object(i.b)("li",{parentName:"ul"},"<REPLACE_SECRET_NAME>")),Object(i.b)("p",null,"Install finished screenshot:\n",Object(i.b)("img",{alt:"Finised",src:n(107).default,title:"Finished"})))}c.isMDXComponent=!0}}]);